// Top-level build file where you can add configuration options common to all sub-projects/modules.
buildscript {
  ext {
    // 完全保留你的高版本配置，不降级！
    kotlinVersion = "2.0.21"
    agpVersion    = "8.13.0"
    reactNativeGradlePluginVersion = "0.81.5"
    apmVersion = "3.0.4"
  }

  repositories {
    // 完全保留你的镜像优先级
    maven { url 'https://mirrors.huaweicloud.com/repository/google/' }
    maven { url 'https://mirrors.huaweicloud.com/repository/maven/' }
    maven { url 'https://developer.huawei.com/repo/' }
    maven { url 'https://emas.aliyun.com/maven/repository/' }
    maven { url 'https://maven.aliyun.com/repository/google' }
    maven { url 'https://maven.aliyun.com/repository/public' }
    maven { url 'https://maven.aliyun.com/nexus/content/repositories/releases/' }
    google()
    mavenCentral()
  }

  dependencies {
    // 完全保留原有依赖，不降级！
    classpath("com.android.tools.build:gradle:${agpVersion}")
    classpath("com.facebook.react:react-native-gradle-plugin:${reactNativeGradlePluginVersion}")
    classpath("org.jetbrains.kotlin:kotlin-gradle-plugin:${kotlinVersion}")
    classpath("com.aliyun.ams:alicloud-apm-plugin:${apmVersion}")
    // 新增：手动引入Expo Gradle插件，避免插件解析时触发兼容问题
    classpath("expo:expo-gradle-plugin:local")
  }
}

allprojects {
  repositories {
    // 完全保留你的仓库配置
    maven { url 'https://mirrors.huaweicloud.com/repository/google/' }
    maven { url 'https://mirrors.huaweicloud.com/repository/maven/' }
    maven { url 'https://developer.huawei.com/repo/' }
    maven { url 'https://emas.aliyun.com/maven/repository/' }
    maven { url 'https://maven.aliyun.com/repository/google' }
    maven { url 'https://maven.aliyun.com/repository/public' }
    maven { url 'https://maven.aliyun.com/nexus/content/repositories/releases/' }
    maven { url 'https://www.jitpack.io' }
    google()
    mavenCentral()
  }
}

// 保留Gradle8.x 正确的startParameter配置
gradle.startParameter.parallelProjectExecution = true
gradle.startParameter.buildCacheEnabled = false

// 保留Expo国内镜像配置
project.ext {
  expo = [
          mavenRepositoryUrl: "https://maven.aliyun.com/repository/public"
  ]
}

// 保留原有插件应用，确保Expo和RN核心功能正常
apply plugin: "expo-root-project"
apply plugin: "com.facebook.react.rootproject"